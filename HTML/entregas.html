<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gestión de Entregas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../CSS/style.css" />
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            padding-top: 60px;
        }

        footer {
            margin-top: auto;
        }

        h1 {
            font-family: 'Arial', sans-serif;
            font-size: 28pt;
            color: #675541;
        }

        .btn-custom {
            background-color: #FEBF00;
            color: #000;
        }

        .btn-custom:hover {
            background-color: #e0aa00;
        }

        .table thead {
            background-color: #675541;
            color: white;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-custom fixed-top bg-transparent">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="../IMG/logo.png" alt="Logo" class="logo" />
            </a>
            <div class="collapse navbar-collapse" id="menuPrincipal">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                    <li class="nav-item"><a class="nav-link" href="clientes.html">Clientes</a></li>
                    <li class="nav-item"><a class="nav-link" href="empleados.html">Empleados</a></li>
                    <!-- Menú desplegable Inventario -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="inventarioDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Inventario
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="inventarioDropdown">
                            <li><a class="dropdown-item" href="inventario.html">Inventario de Productos</a></li>
                            <li><a class="dropdown-item" href="inventarioCategorias.html">Inventario de Categorías</a>
                            </li>
                        </ul>
                    <li class="nav-item"><a class="nav-link" href="entregas.html">Entregas</a></li>
                    <li class="nav-item"><a class="nav-link" href="proveedores.html">Proveedores</a></li>
                    <li class="nav-item"><a class="nav-link" href="dashboardReportes.html">Reportes</a></li>
                    <li class="nav-item">
                    <li class="nav-item"><a class="nav-link" href="registro.html"> <i class="fas fa-user"></i> Gestionar
                            Credenciales</a></li>
                    <li class="nav-item"><a class="nav-link" href="login.html"> <i class="fas fa-sign-out-alt"></i>
                            Cerrar Sesión</a></li>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4 mb-5">
        <h1>Lista de Entregas</h1>

        <div class="text-end">
            <button class="btn btn-custom my-3" data-bs-toggle="modal" data-bs-target="#modalAgregarEntrega">Registrar
                Entrega</button>
        </div>

        <!-- Filtros -->
        <div class="row mb-3">
            <div class="col-md-3">
                <input type="text" id="filtroCliente" class="form-control" placeholder="Filtrar por cliente" />
            </div>
            <div class="col-md-3">
                <input type="date" id="filtroFecha" class="form-control" />
            </div>
            <div class="col-md-3">
                <select id="filtroEstado" class="form-control">
                    <option value="">Todos los estados</option>
                    <option value="Pendiente">Pendiente</option>
                    <option value="En camino">En camino</option>
                    <option value="Realizada">Realizada</option>
                </select>
            </div>
        </div>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Cliente</th>
                    <th>Mensajero Asignado</th>
                    <th>Fecha Entrega</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaEntregas">
                <tr>
                    <td colspan="5" class="text-center text-muted">Cargando entregas...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="modal fade" id="modalAgregarEntrega" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="formAgregarEntrega" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title">Registrar Entrega</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="cedulaCliente" class="form-label">Cédula del Cliente</label>
                            <input type="text" class="form-control" id="cedulaCliente" required />
                        </div>
                        <div class="mb-3">
                            <label for="mensajeroEntrega" class="form-label">Mensajero Asignado</label>
                            <select class="form-control" id="mensajeroEntrega" required>
                                <option value="">Cargando mensajeros...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fechaEntrega" class="form-label">Fecha de Entrega</label>
                            <input type="date" class="form-control" id="fechaEntrega" required />
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-warning" data-bs-dismiss="modal">Siguiente</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAgregarDetallesEntrega" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="formAgregarDetallesEntrega">
                    <div class="modal-header">
                        <h5 class="modal-title">Detalles Entrega</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="productoEntrega" class="form-label">Seleccione el producto</label>
                            <select class="form-control" id="productoEntrega" required>
                                <option value="">Cargando productos...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="cantidadEntrega" class="form-label">Cantidad</label>
                            <input type="number" class="form-control" id="cantidadEntrega" min="1" required />
                        </div>
                        <div class="mb-3">
                            <label for="precioEntrega" class="form-label">Precio de la entrega</label>
                            <input type="number" class="form-control" id="precioEntrega" min="0.01" step="0.01"
                                required />
                        </div>
                        <div class="mb-3">
                            <label for="descuentoEntrega" class="form-label">Descuento(%)</label>
                            <input type="number" class="form-control" id="descuentoEntrega" min="0" step="0.01"
                                required />
                        </div>
                        <div class="mb-3">
                            <label for="ivaEntrega" class="form-label">IVA(13%)</label>
                            <input type="number" class="form-control" id="ivaEntrega" value="13.00" min="0.01"
                                step="0.01" readonly />
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-warning" data-bs-dismiss="modal">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL EDITAR ENTREGA -->
    <div class="modal fade" id="modalEditarEntrega" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="formEditarEntrega">
                    <div class="modal-header">
                        <h5 class="modal-title">Editar Entrega</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="editIdEntrega" name="id_entrega">

                        <div class="mb-3">
                            <label for="editCedulaCliente" class="form-label">Cédula del Cliente</label>
                            <input type="text" class="form-control" id="editCedulaCliente" required>
                            <input type="hidden" id="editClienteId" name="cliente_id">
                        </div>


                        <div class="mb-3">
                            <label for="editMensajero" class="form-label">Mensajero Asignado</label>
                            <select class="form-control" id="editMensajero" name="empleado_id" required>
                                <option value="">Cargando mensajeros...</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="editFecha" class="form-label">Fecha de Entrega</label>
                            <input type="date" class="form-control" id="editFecha" name="fecha" required>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-warning" data-bs-dismiss="modal">Siguiente</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL EDITAR DETALLE -->
    <div class="modal fade" id="modalEditarDetalle" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="formEditarDetalle">
                    <div class="modal-header">
                        <h5 class="modal-title">Editar Entrega</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="editIdDetalle" name="id_detalle">

                        <div class="mb-3">
                            <label for="editProductoEntrega" class="form-label">Producto</label>
                            <select class="form-control" id="editProductoEntrega" name="id_producto" required>
                                <option value="">Cargando productos...</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="editCantidad" class="form-label">Cantidad</label>
                            <input type="number" class="form-control" id="editCantidad" name="cantidad" min="1"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="editPrecio" class="form-label">Precio de la entrega</label>
                            <input type="number" class="form-control" id="editPrecio" name="precio_unitario" min="0.01"
                                step="0.01" required>
                        </div>

                        <div class="mb-3">
                            <label for="editDescuento" class="form-label">Descuento (%)</label>
                            <input type="number" class="form-control" id="editDescuento" name="descuento_aplicado"
                                min="0" step="0.01">
                        </div>

                        <div class="mb-3">
                            <label for="editIVA" class="form-label">IVA (13%)</label>
                            <input type="number" class="form-control" id="editIVA" name="porcentaje_iva_aplicado"
                                value="13.00" readonly>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-warning" data-bs-dismiss="modal">Guardar cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Cambiar Estado -->
    <div class="modal fade" id="modalCambiarEstado" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cambiar Estado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="indiceEstadoEntrega" />
                    <label for="nuevoEstado" class="form-label">Seleccione nuevo estado</label>
                    <select id="nuevoEstado" class="form-control">
                        <option value="Pendiente">Pendiente</option>
                        <option value="En camino">En camino</option>
                        <option value="Completada">Completada</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="guardarNuevoEstado()" data-bs-dismiss="modal">Guardar
                        Estado</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalles de Entrega -->
    <div class="modal fade" id="modalDetallesEntrega" tabindex="-1" aria-labelledby="modalDetallesEntregaLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #FEBF00; color: black;">
                    <h5 class="modal-title" id="modalDetallesEntregaLabel">Detalle de la Entrega</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body text-center">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Cliente</dt>
                        <dd class="col-sm-8" id="detCliente"></dd>

                        <dt class="col-sm-4">Dirección</dt>
                        <dd class="col-sm-8" id="detDireccion"></dd>

                        <dt class="col-sm-4">Teléfono</dt>
                        <dd class="col-sm-8" id="detTelefono"></dd>

                        <dt class="col-sm-4">Repartidor</dt>
                        <dd class="col-sm-8" id="detRepartidor"></dd>

                        <dt class="col-sm-4">Fecha de Entrega</dt>
                        <dd class="col-sm-8" id="detFechaEntrega"></dd>

                        <dt class="col-sm-4">Producto</dt>
                        <dd class="col-sm-8" id="detProducto"></dd>

                        <dt class="col-sm-4">Cantidad</dt>
                        <dd class="col-sm-8" id="detCantidad"></dd>

                        <dt class="col-sm-4">Precio de la entrega</dt>
                        <dd class="col-sm-8" id="detPrecio"></dd>

                        <dt class="col-sm-4">Descuento</dt>
                        <dd class="col-sm-8" id="detDescuento"></dd>

                        <dt class="col-sm-4">IVA</dt>
                        <dd class="col-sm-8" id="detIVA"></dd>

                        <dt class="col-sm-4">Estado</dt>
                        <dd class="col-sm-8" id="detEstado"></dd>
                    </dl>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer-custom mt-auto py-4">
        <div class="container text-center">
            <p class="mb-1 fw-bold">Abrasivos Industriales S.A.</p>
            <p class="mb-0 small">© 2025 Todos los derechos reservados</p>
        </div>
    </footer>

    <script src="../JS/adminEntregas.js"></script>
</body>

</html>